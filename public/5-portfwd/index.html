<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.142.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/workshop_awsfcj_2024/images/favicon.png" type="image/png">

    <title>Loading Data from S3 to Snowflake :: AWS System Manager</title>

    
    <link href="/workshop_awsfcj_2024/css/nucleus.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/fontawesome-all.min.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/hybrid.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/featherlight.min.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/perfect-scrollbar.min.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/auto-complete.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/atom-one-dark-reasonable.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/theme.css?1739949978" rel="stylesheet">
    <link href="/workshop_awsfcj_2024/css/hugo-theme.css?1739949978" rel="stylesheet">
    
    <link href="/workshop_awsfcj_2024/css/theme-workshop.css?1739949978" rel="stylesheet">
    
    

    <script src="/workshop_awsfcj_2024/js/jquery-3.3.1.min.js?1739949978"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/workshop_awsfcj_2024/5-portfwd/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>




<script type="text/javascript" src="/workshop_awsfcj_2024/js/lunr.min.js"></script>
<script type="text/javascript" src="/workshop_awsfcj_2024/js/auto-complete.js"></script>

<script type="text/javascript">
    
        var baseurl = "https:\/\/vuthibichngoc.github.io\/workshop_awsfcj_2024\/";
    
</script>

<script type="text/javascript" src="/workshop_awsfcj_2024/js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/1-introduce/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/1-introduce/">
           <b> 1. </b> Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/2-prerequiste/" title="Preparation " class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/2-prerequiste/">
           <b> 2. </b> Preparation 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/2-prerequiste/2.1-createec2/" title="Create IAM User" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/2-prerequiste/2.1-createec2/">
           <b> 2.1 </b> Create IAM User
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/2-prerequiste/2.2-createiamrole/" title="Create Snowflake Account" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/2-prerequiste/2.2-createiamrole/">
           <b> 2.2 </b> Create Snowflake Account
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/2-prerequiste/2.3-createtweldata/" title="Create Twelvedata Account" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/2-prerequiste/2.3-createtweldata/">
           <b> 2.3 </b> Create Twelvedata Account
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/3-accessibilitytoinstances/" title="Collecting and Storing Data in DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/3-accessibilitytoinstances/">
           <b> 3. </b> Collecting and Storing Data in DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/3-accessibilitytoinstances/3.1-public-instance/" title="Create table in DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/3-accessibilitytoinstances/3.1-public-instance/">
           <b> 3.1. </b> Create table in DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/3-accessibilitytoinstances/3.2-private-instance/" title="Storing Data in DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/3-accessibilitytoinstances/3.2-private-instance/">
           <b> 3.2. </b> Storing Data in DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/4-s3log/" title="Transforming and Storing Data as CSV in S3" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/4-s3log/">
           <b> 4. </b> Transforming and Storing Data as CSV in S3
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/4-s3log/4.1-updateiamrole/" title="Create S3 Bucket" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/4-s3log/4.1-updateiamrole/">
           <b> 4.1 </b> Create S3 Bucket
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/4-s3log/4.2-creates3bucket/" title="Store Data into S3 Bucket" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/4-s3log/4.2-creates3bucket/">
           <b> 4.2 </b> Store Data into S3 Bucket
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/5-portfwd/" title="Loading Data from S3 to Snowflake" class="dd-item 
        
        active
        
        ">
      <a href="/workshop_awsfcj_2024/5-portfwd/">
           <b> 5. </b> Loading Data from S3 to Snowflake
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/workshop_awsfcj_2024/6-cleanup/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/workshop_awsfcj_2024/6-cleanup/">
          <b>6. </b>Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://vuthibichngoc.github.io/workshop_awsfcj_2024/5-portfwd/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="https://vuthibichngoc.github.io/workshop_awsfcj_2024/vi/5-portfwd/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>28-01-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Bích Ngọc </a> <br>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/workshop_awsfcj_2024/'>Building a Stock Data Processing and Storage System using AWS Lambda, DynamoDB, S3, and Snowflake</a> > Loading Data from S3 to Snowflake
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#create-an-iam-role-to-allow-snowflake-access-to-s3">Create an IAM Role to allow Snowflake access to S3</a></li>
        <li><a href="#create-a-database-in-snowflake">Create a Database in Snowflake</a></li>
        <li><a href="#observing-data-in-snowflake">Observing Data in Snowflake</a></li>
        <li><a href="#adding-eventbridge-cloudwatch-events">Adding EventBridge (CloudWatch Events)</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Loading Data from S3 to Snowflake
            </h1>
          

        



	
<div class="notices tip" ><p>This section requires a Snowflake account, so make sure you have one.</p>
</div>

<p>In the previous section, we had stock data stored as daily <code>.csv</code> files in an <strong>S3 Bucket</strong>. Now, we will upload it to <strong>Snowflake</strong> for easier visualization, usage, and management.</p>
<h3 id="create-an-iam-role-to-allow-snowflake-access-to-s3">Create an IAM Role to allow Snowflake access to S3</h3>
<p><strong>1.</strong> In <strong>AWS Management Console</strong>, search for the <a href="https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/home"><strong>IAM</strong></a> service and select it.</p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/2.prerequisite/2.1.1.png" alt="IAM1"></p>
<p><strong>2.</strong> At <strong>Step 01</strong></p>
<ul>
<li><strong>Trusted entity type</strong>: <strong>AWS account</strong></li>
<li><strong>An AWS account</strong>: <strong>This account</strong></li>
<li><strong>Next</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/1.png" alt="4"></p>
<p><strong>3.</strong> At <strong>Step 02</strong></p>
<ul>
<li>Grant this role the <strong>AmazonS3FullAccess</strong> permission</li>
<li><strong>Next</strong></li>
</ul>
<p><strong>4.</strong> At <strong>Step 03</strong></p>
<ul>
<li><strong>Role name</strong>: <code>snowflake-stock-prices</code></li>
<li>Review the details</li>
<li><strong>Create role</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/2.png" alt="4"></p>

<div class="notices tip" ><p>Remember to save the ARN of this role for the next step.</p>
</div>

<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/23.png" alt="4"></p>
<hr>
<h3 id="create-a-database-in-snowflake">Create a Database in Snowflake</h3>
<p><strong>1.</strong> Go to <a href="https://app.snowflake.com/">Snowflake</a></p>
<ul>
<li>Log in with the created account.</li>
</ul>
<p><strong>2.</strong> Select <strong>Create</strong> - <strong>SQL worksheets</strong></p>
<ul>
<li>Run the following commands:</li>
</ul>
<p><code>CREATE DATABASE STOCK_PRICES;</code></p>
<p><code>USE DATABASE STOCK_PRICES;</code></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/3.png" alt="4"></p>
<ul>
<li><strong>Database created successfully.</strong></li>
</ul>
<p><strong>3.</strong> Create the <strong>stock_prices_data</strong> table in <strong>Snowflake</strong> and load data into it.</p>
<p><strong>a.</strong> Create the stock data table.</p>
<pre tabindex="0"><code>CREATE OR REPLACE TABLE stock_prices_data(
    low          VARCHAR(128),  
    symbol       VARCHAR(128),
    timestamp    VARCHAR(128),
    open         VARCHAR(128),
    volume       VARCHAR(128),
    high         VARCHAR(128),
    close        VARCHAR(128),
    date         VARCHAR(128)
);
</code></pre><p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/4.png" alt="4"></p>
<ul>
<li><strong>Table created successfully in Snowflake.</strong></li>
</ul>
<p><strong>b.</strong> Create an <strong>Integration Object</strong> to connect with S3.</p>

<div class="notices info" ><p>An <strong>Integration Object</strong> in Snowflake is an external connection object that allows Snowflake to communicate with other services such as S3.</p>
</div>

<p>Run the following command to create an <strong>Integration Object</strong> to connect with S3.</p>
<pre tabindex="0"><code>
create or replace storage integration s3_int
  type = external_stage
  storage_provider = s3
  enabled = true
  storage_aws_role_arn = &#39;&lt;&lt;Your role ARN&gt;&gt;&#39;
  storage_allowed_locations = (&#39;s3://data-stock-prices-01/snowflake/&#39;);
</code></pre>
<div class="notices tip" ><p>Enter the ARN of the IAM Role created in the previous step to allow Snowflake to access S3, and modify the S3 path to match your bucket name.</p>
</div>

<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/5.png" alt="4"></p>
<p><strong>c.</strong> Check detailed information about <strong>Storage Integration</strong>.</p>

<div class="notices info" ><p><strong>Storage Integration</strong> is an object in Snowflake used to securely and automatically connect with external storage services like AWS S3. Instead of providing an access key and secret key to access S3, Snowflake allows the use of AWS IAM Roles to grant access securely.</p>
</div>

<p>Run the command:<br>
<code>DESC INTEGRATION s3_int;</code><br>
to check detailed information about <strong>Storage Integration</strong>.</p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/6.png" alt="4"></p>

<div class="notices note" ><p>Save the <strong>property_value</strong> of the following <strong>properties</strong>: <strong>STORAGE_AWS_IAM_USER_ARN</strong>, <strong>STORAGE_AWS_ROLE_ARN</strong>, <strong>STORAGE_AWS_EXTERNAL_ID</strong></p>
</div>

<ul>
<li>Go back to <a href="https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/home"><strong>IAM</strong></a> - select <strong>Roles</strong> - choose the role created in the previous step.</li>
<li>Select <strong>Trust relationship</strong> - <strong>Edit trust policy</strong></li>
<li>Enter the <strong>property_value</strong> of <strong>STORAGE_AWS_ROLE_ARN</strong> saved earlier after <strong>&ldquo;AWS&rdquo;</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/7.png" alt="4"></p>
<p>Then, continue by selecting <strong>Add condition</strong></p>
<ul>
<li>Fill in the following information:</li>
</ul>
<p>&ndash; <strong>Condition key</strong>: <code>sts:ExternalId</code></p>
<p>&ndash; <strong>Qualifier</strong>: <code>Default</code></p>
<p>&ndash; <strong>Operator</strong>: <code>StringEquals</code></p>
<p>&ndash; <strong>Value</strong>: Enter the <strong>property_value</strong> of <strong>STORAGE_AWS_EXTERNAL_ID</strong> saved earlier.</p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/8.png" alt="4"></p>
<ul>
<li><strong>Add condition</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/9.png" alt="4"></p>
<p><strong>d.</strong> Create <strong>File Format</strong> to read CSV files</p>
<p>Run the following command:</p>
<pre tabindex="0"><code>create or replace file format csv_format
                    type = csv
                    field_delimiter = &#39;,&#39;
                    skip_header = 1
                    null_if = (&#39;NULL&#39;, &#39;null&#39;)
                    empty_field_as_null = true;
</code></pre><p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/10.png" alt="4"></p>
<p><strong>e.</strong> Create <strong>External Stage</strong> to connect with <strong>S3</strong></p>

<div class="notices info" ><p><strong>External Stage</strong> is an external storage repository used by Snowflake to retrieve data from cloud storage services like Amazon S3, Google Cloud Storage, or Azure Blob Storage. It allows Snowflake to read and write data directly from/to external storage without needing to load data into Snowflake first.</p>
</div>

<p>Run the following command to create an <strong>External Stage</strong> to connect with the <strong>S3</strong> bucket created earlier.</p>
<pre tabindex="0"><code>create or replace stage ext_csv_stage
  URL = &#39;s3://data-stock-prices-01/snowflake/&#39;
  STORAGE_INTEGRATION = s3_int
  file_format = csv_format;
</code></pre><p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/11.png" alt="4"></p>
<p><strong>f.</strong> Create <strong>Pipe</strong> to automatically load data</p>

<div class="notices info" ><p><strong>Pipe</strong> in Snowflake is a mechanism that enables continuous data loading from an External Stage (S3) into a table in Snowflake. It utilizes <strong>Snowpipe</strong>, a Snowflake service that automatically detects new files in cloud storage (e.g., S3) and loads the data into the table without requiring manual execution of the <code>COPY INTO</code> command.</p>
</div>

<ul>
<li>Go back to <a href="https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/home"><strong>IAM</strong></a> - <strong>Roles</strong> - select the role created in the previous step.</li>
<li>Select <strong>Trust relationship</strong> - <strong>Edit trust policy</strong></li>
<li>Modify the content and enter the <strong>property_value</strong> of <strong>STORAGE_AWS_IAM_USER_ARN</strong> saved earlier after <strong>&ldquo;AWS&rdquo;</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/13.png" alt="4"></p>
<p>Run the following command.</p>
<pre tabindex="0"><code>create or replace pipe mypipe auto_ingest=true as
copy into stock_price_data
from @ext_csv_stage
on_error = CONTINUE;
</code></pre><p><strong>g.</strong> Execute the command <code>show pipes</code> to check <strong>pipe</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/15.png" alt="4"></p>

<div class="notices note" ><p>Please save the information displayed in the <strong>notification_channel</strong> column.</p>
</div>

<ul>
<li>Go back to <a href="https://us-east-1.console.aws.amazon.com/s3/home?region=us-east-1">S3</a></li>
<li>Select the <strong>bucket</strong> used to store data that will be uploaded to <strong>Snowflake</strong></li>
<li>Navigate to <strong>Event notifications</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/16.png" alt="4"></p>
<ul>
<li>Click <strong>Create event notification</strong></li>
<li>In <strong>General configuration</strong></li>
</ul>
<p>&ndash; <strong>Event name</strong>: <code>stock-price-event</code></p>
<ul>
<li>In <strong>Event types</strong></li>
</ul>
<p>&ndash; Select <strong>All object create events</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/17.png" alt="4"></p>
<ul>
<li>In <strong>Destination</strong></li>
</ul>
<p>&ndash; <strong>Destination</strong>: <strong>SQS queue</strong></p>
<p>&ndash; <strong>SQS queue</strong>: enter the <strong>notification_channel</strong> information that was saved earlier.</p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/18.png" alt="4"></p>
<ul>
<li><strong>Save changes</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/19.png" alt="4"></p>
<p><strong>Event notification</strong> has been successfully created.</p>
<ul>
<li>Go back to <a href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/discover?tab=code"><strong>Lambda</strong></a></li>
<li>Select <strong>Function</strong></li>
<li>Select the first function created to insert data into <strong>DynamoDB</strong> (in this case, the function is named <strong>fetch_code</strong>)</li>
<li>Navigate to <strong>Code</strong></li>
<li>Select the <strong>Test event</strong> that was used before - choose <strong>Edit test event</strong> - then select <strong>Invoke</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/20.png" alt="4"><br>
<img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/21.png" alt="4"></p>
<p><strong>4.</strong> <strong>Results</strong></p>
<ul>
<li>Execute the command <code>select * from stock_price_data;</code> to check if the data has been loaded from <strong>S3</strong> into <strong>Snowflake</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/22.png" alt="4"></p>
<p><strong>The data from S3 has been successfully added to Snowflake.</strong></p>
<h3 id="observing-data-in-snowflake">Observing Data in Snowflake</h3>
<p>Select <strong>Chart</strong> on the <strong>result</strong> bar in <strong>Snowflake</strong> after running the query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> stock_price_data;
</span></span></code></pre></div><p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/25.png" alt="4"></p>
<ul>
<li>Here, you can create charts based on the data stored in the table.</li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/26.png" alt="4"></p>
<p>The sections include: <strong>Chart type</strong>, <strong>Data</strong>, and <strong>Appearance</strong></p>
<h4 id="1-chart-type"><strong>1. Chart type</strong></h4>

<div class="notices info" ><p><strong>Chart type</strong> allows users to select different types of charts to visualize data.</p>
</div>

<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/27.png" alt="4"></p>
<p>&ndash; <strong>Line Chart</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/28.png" alt="4"><br>
<img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/29.png" alt="4"></p>
<p>&ndash; <strong>Bar Chart</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/30.png" alt="4"><br>
<img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/31.png" alt="4"></p>
<p>&ndash; <strong>Scatter Plot</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/32.png" alt="4"></p>
<p>&ndash; <strong>Heatgrid</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/33.png" alt="4"></p>
<p>&ndash; <strong>Scorecard</strong></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/34.png" alt="4"></p>
<h4 id="2-data"><strong>2. Data</strong></h4>

<div class="notices info" ><p><strong>Data</strong> refers to the information stored in a table or retrieved through a query. This serves as the source for chart visualization.</p>
</div>

<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/35.png" alt="4"></p>
<p>It allows you to select specific columns, aggregate values (sum, max, min, etc.), remove columns from the chart, or add new ones.</p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/36.png" alt="4"></p>
<h4 id="3-appearance"><strong>3. Appearance</strong></h4>

<div class="notices info" ><p><strong>Appearance</strong> relates to the visual representation of the chart. It does not affect the data but enhances readability and interpretation.</p>
</div>

<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/37.png" alt="4"></p>
<p><strong>Example</strong>: Adding column names and legend to the chart.</p>
<ul>
<li>Before adding:</li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/39.png" alt="4"></p>
<ul>
<li>After adding:</li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/38.png" alt="4"></p>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/40.png" alt="4"></p>
<hr>

<div class="notices info" ><p>Next, we will integrate <strong>EventBridge</strong> to ensure the data is continuously updated in real-time.</p>
</div>

<h3 id="adding-eventbridge-cloudwatch-events">Adding EventBridge (CloudWatch Events)</h3>
<p><strong>1.</strong> Go back to AWS and select <strong>Lambda</strong></p>
<ul>
<li>Choose <strong>Function</strong></li>
<li>Select the function <strong>fetch_code</strong></li>
</ul>
<p><strong>2.</strong> Add an EventBridge (CloudWatch Events) trigger</p>
<ul>
<li>Go to <strong>Configuration</strong> - select <strong>Trigger</strong></li>
<li>Click <strong>Add trigger</strong></li>
<li><strong>Select a source</strong>: <code>EventBridge CloudWatch Events</code></li>
<li><strong>Rule</strong>: Create a new rule</li>
<li><strong>Rule name</strong>: <code>every_days</code></li>
<li><strong>Schedule expression</strong>: <code>rate(1 day)</code></li>
<li>Click <strong>Add</strong></li>
</ul>
<p><img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/5.1.6.png" alt="4"><br>
<img src="https://vuthibichngoc.github.io/workshop_awsfcj_2024/images/5.fwd/5.1.7.png" alt="4"></p>

<div class="notices info" ><p>Once completed, the data will be updated and stored continuously on a daily basis.</p>
</div>






<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/workshop_awsfcj_2024/4-s3log/4.2-creates3bucket/" title="Store Data into S3 Bucket"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/workshop_awsfcj_2024/6-cleanup/" title="Clean up resources" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/workshop_awsfcj_2024/js/clipboard.min.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/perfect-scrollbar.min.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/perfect-scrollbar.jquery.min.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/jquery.sticky.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/featherlight.min.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/highlight.pack.js?1739949978"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/workshop_awsfcj_2024/js/modernizr.custom-3.6.0.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/learn.js?1739949978"></script>
    <script src="/workshop_awsfcj_2024/js/hugo-learn.js?1739949978"></script>

    <link href="/workshop_awsfcj_2024/mermaid/mermaid.css?1739949978" rel="stylesheet" />
    <script src="/workshop_awsfcj_2024/mermaid/mermaid.js?1739949978"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
